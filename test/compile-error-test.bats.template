#!/usr/bin/env bats
# Compile error test
# 
# The test case here feeds a malformed .ddl into ddlog's check command and compares whether it produces an expected error.

source "$BATS_TEST_DIRNAME"/../bats-template.bash  # for $TESTDIR, $it, etc.

# some preconditions
setup() {
    [ -e "$TESTDIR" ]
    expectedError="$TESTDIR"/compile-error.expected
    [ -e "$expectedError" ]
    actualError=${expectedError%.expected}.actual
}

# check if input produces a compile error
@test "$it compiles input" {
    ! ddlog check "$TESTDIR"/input.ddl >/dev/null 2>"$actualError"
    diff "$expectedError" "$actualError"
}

