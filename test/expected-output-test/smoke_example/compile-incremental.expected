
  deepdive.db.default {
    driver: "org.postgresql.Driver"
    url: "jdbc:postgresql://"${PGHOST}":"${PGPORT}"/"${DBNAME}
    user: ${PGUSER}
    password: ${PGPASSWORD}
    dbname: ${DBNAME}
    host: ${PGHOST}
    port: ${PGPORT}
    incremental_mode: INCREMENTAL
    }
    

      deepdive.schema.keys {
        dd_delta_smoke : [person_id]
        dd_new_smoke : [person_id]
        dd_delta_cancer : [person_id]
        dd_new_cancer : [person_id]
      }

      deepdive.schema.variables {
        dd_new_smoke.label: Boolean
smoke.label: Boolean
cancer.label: Boolean
dd_delta_cancer.label: Boolean
dd_new_cancer.label: Boolean
dd_delta_smoke.label: Boolean
      }
    

          deepdive.extraction.extractors.extraction_rule_13 {
            sql: """ DROP TABLE IF EXISTS dd_delta_friends CASCADE;
            CREATE TABLE
            dd_delta_friends(person_id bigint,
                friend_id bigint,
                dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_17 {
            sql: """ DROP TABLE IF EXISTS dd_delta_smoke CASCADE;
            CREATE TABLE
            dd_delta_smoke(person_id bigint,
              id bigint,
              label boolean,
              dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_6 {
            sql: """ DROP TABLE IF EXISTS dd_new_person_has_cancer CASCADE;
            CREATE TABLE
            dd_new_person_has_cancer(person_id bigint,
                        has_cancer boolean,
                        dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_1 {
            sql: """ DROP TABLE IF EXISTS dd_delta_person CASCADE;
            CREATE TABLE
            dd_delta_person(person_id bigint,
               name text,
               dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_2 {
            sql: """ DROP TABLE IF EXISTS dd_new_person CASCADE;
            CREATE TABLE
            dd_new_person(person_id bigint,
             name text,
             dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_5 {
            sql: """ DROP TABLE IF EXISTS dd_delta_person_has_cancer CASCADE;
            CREATE TABLE
            dd_delta_person_has_cancer(person_id bigint,
                          has_cancer boolean,
                          dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_18 {
            sql: """ DROP TABLE IF EXISTS dd_new_smoke CASCADE;
            CREATE TABLE
            dd_new_smoke(person_id bigint,
            id bigint,
            label boolean,
            dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_21 {
            sql: """ DROP TABLE IF EXISTS dd_delta_cancer CASCADE;
            CREATE TABLE
            dd_delta_cancer(person_id bigint,
               id bigint,
               label boolean,
               dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_9 {
            sql: """ DROP TABLE IF EXISTS dd_delta_person_smokes CASCADE;
            CREATE TABLE
            dd_delta_person_smokes(person_id bigint,
                      smokes boolean,
                      dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_10 {
            sql: """ DROP TABLE IF EXISTS dd_new_person_smokes CASCADE;
            CREATE TABLE
            dd_new_person_smokes(person_id bigint,
                    smokes boolean,
                    dd_count int)
            """
            style: "sql_extractor"
          }

          deepdive.extraction.extractors.extraction_rule_14 {
            sql: """ DROP TABLE IF EXISTS dd_new_friends CASCADE;
            CREATE TABLE
            dd_new_friends(person_id bigint,
              friend_id bigint,
              dd_count int)
            """
            style: "sql_extractor"
          }

        deepdive.extraction.extractors.cleanup {
          sql: """
          TRUNCATE dd_delta_friends;
          TRUNCATE dd_delta_smoke;
          TRUNCATE dd_new_person_has_cancer;
          TRUNCATE dd_delta_person;
          TRUNCATE dd_new_person;
          TRUNCATE dd_delta_person_has_cancer;
          TRUNCATE dd_new_smoke;
          TRUNCATE dd_delta_cancer;
          TRUNCATE dd_delta_person_smokes;
          TRUNCATE dd_new_person_smokes;
          TRUNCATE dd_new_friends;
          """
          style: "sql_extractor"
        }

      deepdive.extraction.extractors.extraction_rule_24 {
        sql: """ 
        INSERT INTO dd_delta_smoke SELECT DISTINCT R0.person_id, 0 as id, R0.smokes AS label , R0.dd_count AS dd_count
          FROM dd_delta_person_smokes R0
        
          
        """
        style: "sql_extractor"
          
      }
    

      deepdive.extraction.extractors.extraction_rule_7 {
        sql: """ TRUNCATE dd_new_person_has_cancer;
        INSERT INTO dd_new_person_has_cancer 
            SELECT R0.person_id, R0.has_cancer, R0.dd_count
            FROM person_has_cancer R0
         UNION ALL 
            SELECT R0.person_id, R0.has_cancer, R0.dd_count
            FROM dd_delta_person_has_cancer R0
        
        """
        style: "sql_extractor"
          
      }
    

      deepdive.extraction.extractors.extraction_rule_3 {
        sql: """ TRUNCATE dd_new_person;
        INSERT INTO dd_new_person 
            SELECT R0.person_id, R0.name, R0.dd_count
            FROM person R0
         UNION ALL 
            SELECT R0.person_id, R0.name, R0.dd_count
            FROM dd_delta_person R0
        
        """
        style: "sql_extractor"
          
      }
    

      deepdive.extraction.extractors.extraction_rule_19 {
        sql: """ TRUNCATE dd_new_smoke;
        INSERT INTO dd_new_smoke SELECT DISTINCT R0.person_id,  id, label , R0.dd_count AS dd_count
          FROM smoke R0
        
           UNION ALL SELECT DISTINCT R0.person_id,  id, label , R0.dd_count AS dd_count
          FROM dd_delta_smoke R0
        
          
        """
        style: "sql_extractor"
          dependencies: [ "extraction_rule_24" ]
      }
    

      deepdive.extraction.extractors.extraction_rule_25 {
        sql: """ 
        INSERT INTO dd_delta_cancer SELECT DISTINCT R0.person_id, 0 as id, R0.has_cancer AS label , R0.dd_count AS dd_count
          FROM dd_delta_person_has_cancer R0
        
          
        """
        style: "sql_extractor"
          
      }
    

      deepdive.extraction.extractors.extraction_rule_23 {
        sql: """ 
        CREATE VIEW dd_new_cancer AS SELECT DISTINCT R0.person_id,  id, label , R0.dd_count AS dd_count
          FROM cancer R0
        
           UNION ALL SELECT DISTINCT R0.person_id,  id, label , R0.dd_count AS dd_count
          FROM dd_delta_cancer R0
        
          
        """
        style: "sql_extractor"
          dependencies: [ "extraction_rule_25" ]
      }
    

      deepdive.extraction.extractors.extraction_rule_11 {
        sql: """ TRUNCATE dd_new_person_smokes;
        INSERT INTO dd_new_person_smokes 
            SELECT R0.person_id, R0.smokes, R0.dd_count
            FROM person_smokes R0
         UNION ALL 
            SELECT R0.person_id, R0.smokes, R0.dd_count
            FROM dd_delta_person_smokes R0
        
        """
        style: "sql_extractor"
          
      }
    

      deepdive.extraction.extractors.extraction_rule_15 {
        sql: """ TRUNCATE dd_new_friends;
        INSERT INTO dd_new_friends 
            SELECT R0.person_id, R0.friend_id, R0.dd_count
            FROM friends R0
         UNION ALL 
            SELECT R0.person_id, R0.friend_id, R0.dd_count
            FROM dd_delta_friends R0
        
        """
        style: "sql_extractor"
          
      }
    

        deepdive.inference.factors.dd_new_cancer_0 {
          input_query: """
          SELECT R0.id AS "dd_new_cancer.R0.id" , R1.id AS "dd_delta_smoke.R1.id"  , R0.dd_count * R1.dd_count * R2.dd_count AS "dd_count" 
          FROM dd_new_cancer R0, dd_delta_smoke R1, person_smokes R2
        WHERE R1.person_id = R0.person_id  AND R2.person_id = R0.person_id  UNION ALL 
          SELECT R0.id AS "dd_new_cancer.R0.id" , R1.id AS "dd_new_smoke.R1.id"  , R0.dd_count * R1.dd_count * R2.dd_count AS "dd_count" 
          FROM dd_new_cancer R0, dd_new_smoke R1, dd_delta_person_smokes R2
        WHERE R1.person_id = R0.person_id  AND R2.person_id = R0.person_id """
          function: "Imply(dd_delta_smoke.R1.label, dd_new_cancer.R0.label)"
          weight: "3.0"
        }
      
deepdive.pipeline.run: ${PIPELINE}
deepdive.pipeline.pipelines.initdb: [extraction_rule_13, extraction_rule_17, extraction_rule_6, extraction_rule_1, extraction_rule_2, extraction_rule_5, extraction_rule_18, extraction_rule_21, extraction_rule_22, extraction_rule_9, extraction_rule_10, extraction_rule_14]
deepdive.pipeline.pipelines.extraction: [extraction_rule_7, extraction_rule_25, extraction_rule_19, extraction_rule_3, extraction_rule_23, extraction_rule_11, extraction_rule_24, extraction_rule_15]
deepdive.pipeline.pipelines.inference: [dd_new_cancer_0]
deepdive.pipeline.pipelines.cleanup: [cleanup]
deepdive.pipeline.base_dir: ${BASEDIR}
